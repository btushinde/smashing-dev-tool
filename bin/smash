#!/usr/bin/env coffee

argv =          require('minimist')(process.argv.slice 2)
chalk =         require 'chalk'
commander =     require 'commander'
required =      require 'require-dir'


project = require '../config/config'
project.helpers = require '../config/helpers'
project.commander = commander

globalConfig = require '../config/global'

{logger, notify, execute} = require '../config/util'
{assets, tasks, args, dir, env} = project

pkg = globalConfig.smash.pkg

# Configure Commander.js
commander
  .version('1.0')
  .option('-v, --verbose',         'Display detailed log information')
  .option('-s, --silent',          'Hide all logs and notifications')
  .option('-w, --watch',          'Watch assets for changes')
  .on '--help', ->
    console.log '  Examples:'
    console.log ''
    console.log '    $ custom-help --help'
    console.log '    $ custom-help -h'
    console.log ''

commander
  .command('*')
  .usage('smash [options]')
  .action (cmd, options) ->
    console.log 'exec "%s" using %s mode', cmd, options.exec_mode

# MAIN MODULES



# App template generation/scaffolding
require('../modules/generate')(globalConfig)

# existing project
if project.pkg

  # Initialization
  require('../modules/init')(project)

  # Compile phase
  require('../modules/compile')(project)

  # Build phase
  require('../modules/build')(project)

  # # Deploy phase
  require('../modules/deploy')(project)

  # Test phase
  require('../modules/test')(project)


  # EXTENDED FUNCTIONALITY
  # Apps
  require('../modules/apps')(project)

  # Documentation generation
  require('../modules/document')(project)


# commander.help()  if argv._.length is 0
commander.parse process.argv
